<nav class="z-50 w-full py-1 px-6 md:px-16 lg:px-24 xl:px-32">
    <div class="flex items-center justify-between">
      <div class="flex-shrink-0">
        <a routerLink="/" class="flex items-center">
          <span class="text-xl font-bold text-slate-900 uppercase">iCenter</span>
          <span class="w-2 h-2 bg-purple-600 rounded-full ml-1"></span>
        </a>
      </div>

      <div class="hidden md:flex items-center gap-8 absolute left-1/2 transform -translate-x-1/2">
        <a routerLink="/" routerLinkActive="text-slate-900 font-semibold" class="text-slate-400 hover:text-slate-600 transition uppercase text-sm tracking-wide">
          Inicio
        </a>
        <a routerLink="/productos" routerLinkActive="text-slate-900 font-semibold" class="text-slate-400 hover:text-slate-600 transition uppercase text-sm tracking-wide">
          Productos
        </a>
        <div 
          class="relative"
          (mouseenter)="openCategoriesDropdown()"
          (mouseleave)="closeCategoriesDropdown()">
          <button 
            type="button"
            (click)="toggleCategoriesDropdown()"
            [class.text-purple-600]="isCategoriesDropdownOpen"
            [class.text-slate-900]="isCategoriesDropdownOpen"
            class="text-slate-400 hover:text-slate-600 transition uppercase text-sm tracking-wide flex items-center gap-1">
            Categorías
            <svg 
              xmlns="http://www.w3.org/2000/svg" 
              width="16" 
              height="16" 
              viewBox="0 0 24 24" 
              fill="none" 
              stroke="currentColor" 
              stroke-width="2" 
              stroke-linecap="round" 
              stroke-linejoin="round"
              [class.rotate-180]="isCategoriesDropdownOpen"
              class="transition-transform duration-200">
              <path d="m6 9 6 6 6-6"/>
            </svg>
          </button>
          
          <div 
            *ngIf="isCategoriesDropdownOpen && categories.length > 0"
            class="absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-[90vw] max-w-[600px] bg-slate-900 rounded-lg shadow-xl p-4 sm:p-6 z-50">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
              <div *ngFor="let category of categories; let i = index" class="cursor-pointer group">
                <div 
                  (click)="navigateToCategory(category.id)"
                  class="hover:text-purple-400 transition-colors">
                  <h3 class="font-semibold text-white mb-1 group-hover:text-purple-400">
                    {{ category.name }}
                  </h3>
                  <p *ngIf="category.description" class="text-sm text-slate-300">
                    {{ category.description }}
                  </p>
                </div>
              </div>
            </div>
            <div class="mt-6 pt-6 border-t border-slate-700">
              <a 
                routerLink="/categorias"
                (click)="closeCategoriesDropdown()"
                class="text-purple-400 hover:text-purple-300 transition-colors text-sm font-medium inline-flex items-center gap-2">
                Ver todas las categorías
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="m9 18 6-6-6-6"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
        <a routerLink="/events" routerLinkActive="text-slate-900 font-semibold" class="text-slate-400 hover:text-slate-600 transition uppercase text-sm tracking-wide">
          Eventos
        </a>
        <a *ngIf="!isLoggedIn() && !isAdmin()" routerLink="/auth" routerLinkActive="text-slate-900 font-semibold" class="text-slate-400 hover:text-slate-600 transition uppercase text-sm tracking-wide">
          Iniciar Sesión
        </a>
        <a *ngIf="isAdmin()" (click)="goToAdminPanel()" class="text-slate-400 hover:text-slate-600 transition uppercase text-sm tracking-wide cursor-pointer">
          Panel Admin
        </a>
      </div>

      <div class="flex-shrink-0 flex items-center gap-3">
        <div class="hidden md:flex items-center gap-2 mr-2">
          <div
            class="relative flex items-center justify-center w-9 h-9 rounded-full border border-slate-200 hover:bg-slate-50 transition-colors cursor-pointer"
            (click)="navigateToCart()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"/>
              <circle cx="20" cy="21" r="1"/>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
            </svg>
            <span *ngIf="cartQuantity > 0" class="absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-500 text-white text-[10px] flex items-center justify-center">
              {{ cartQuantity }}
            </span>
          </div>
          <div *ngIf="cartTotal > 0" class="text-xs font-medium text-slate-800">
            ${{ cartTotal | number:'1.2-2' }}
          </div>
        </div>
        <!-- Usuario logueado (cliente o admin) -->
        <div *ngIf="isLoggedIn()" class="relative user-menu-container">
          <button
            type="button"
            (click)="toggleUserMenu()"
            class="flex items-center gap-2 text-slate-600 hover:text-slate-900 transition cursor-pointer">
            <div *ngIf="currentUser?.avatar" class="w-10 h-10 rounded-full overflow-hidden border-2 border-purple-600">
              <img [src]="currentUser!.avatar!" [alt]="currentUser!.name || 'Usuario'" class="w-full h-full object-cover">
            </div>
            <div *ngIf="!currentUser?.avatar" [class]="'w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold text-sm ' + getAvatarColor(currentUser?.name || 'Usuario')">
              {{ getInitials(currentUser?.name || 'Usuario') }}
            </div>
            <svg
              class="w-4 h-4 transition-transform hidden md:block"
              [class.rotate-180]="isUserMenuOpen"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>

          <!-- Dropdown Menu -->
          <div
            *ngIf="isUserMenuOpen"
            class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50">
            <a
              *ngIf="!isAdmin()"
              routerLink="/perfil"
              (click)="closeUserMenu()"
              class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer transition">
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
              <span>Mi Perfil</span>
            </a>
            <a
              *ngIf="isAdmin()"
              (click)="goToAdminPanel(); closeUserMenu()"
              class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer transition">
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
              </svg>
              <span>Panel Administrador</span>
            </a>
            <a
              *ngIf="!isAdmin()"
              routerLink="/pedidos"
              (click)="closeUserMenu()"
              class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 cursor-pointer transition">
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
              </svg>
              <span>Mis Pedidos</span>
            </a>
            <div class="border-t border-gray-200 my-1"></div>
            <a
              (click)="logout()"
              class="flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50 cursor-pointer transition">
              <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
              </svg>
              <span>Cerrar sesión</span>
            </a>
          </div>
        </div>

        <!-- Usuario no logueado -->
        <a *ngIf="!isLoggedIn() && !isAdmin()" routerLink="/auth/register" class="hidden md:flex items-center gap-2 px-5 py-2.5 bg-slate-900 text-white hover:bg-slate-800 active:scale-95 transition-all rounded-full text-sm font-medium">
          <span>Registrarse</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14"/>
            <path d="m12 5 7 7-7 7"/>
          </svg>
        </a>

        <div class="md:hidden flex items-center gap-3">
          <div
            class="relative flex items-center justify-center w-9 h-9 rounded-full border border-slate-200 hover:bg-slate-50 transition-colors"
            (click)="navigateToCart(true)"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"/>
              <circle cx="20" cy="21" r="1"/>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
            </svg>
            <span *ngIf="cartQuantity > 0" class="absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 rounded-full bg-red-500 text-white text-[10px] flex items-center justify-center">
              {{ cartQuantity }}
            </span>
          </div>
          <button type="button" (click)="toggleMenu()" class="active:scale-90 transition" aria-label="Abrir menú">
          <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 5h16"/>
            <path d="M4 12h16"/>
            <path d="M4 19h16"/>
          </svg>
          </button>
        </div>
    </div>
  </div>
</nav>

<div [class]="'fixed inset-0 z-[100] bg-white text-slate-800 flex flex-col items-center justify-center text-lg gap-8 md:hidden transition-transform duration-300 ' + (isMenuOpen ? 'translate-x-0' : '-translate-x-full')">
  <a routerLink="/" (click)="closeMenu()" class="hover:text-slate-900 transition uppercase">
    Inicio
  </a>
  <a routerLink="/productos" (click)="closeMenu()" class="hover:text-slate-900 transition uppercase">
    Productos
  </a>
  <div class="w-full px-8">
    <button 
      type="button"
      (click)="toggleCategoriesDropdown()"
      class="w-full flex items-center justify-between hover:text-slate-900 transition uppercase">
      <span>Categorías</span>
      <svg 
        xmlns="http://www.w3.org/2000/svg" 
        width="20" 
        height="20" 
        viewBox="0 0 24 24" 
        fill="none" 
        stroke="currentColor" 
        stroke-width="2" 
        stroke-linecap="round" 
        stroke-linejoin="round"
        [class.rotate-180]="isCategoriesDropdownOpen"
        class="transition-transform duration-200">
        <path d="m6 9 6 6 6-6"/>
      </svg>
    </button>
    <div 
      *ngIf="isCategoriesDropdownOpen && categories.length > 0"
      class="mt-4 w-full bg-slate-50 rounded-lg p-4 max-h-[400px] overflow-y-auto">
      <div class="space-y-3">
        <div 
          *ngFor="let category of categories"
          (click)="navigateToCategory(category.id); closeMenu()"
          class="cursor-pointer p-3 rounded hover:bg-slate-200 transition-colors">
          <h3 class="font-semibold text-slate-900 mb-1">
            {{ category.name }}
          </h3>
          <p *ngIf="category.description" class="text-sm text-slate-600">
            {{ category.description }}
          </p>
        </div>
      </div>
      <a 
        routerLink="/categorias"
        (click)="closeMenu()"
        class="mt-4 block text-center text-purple-600 hover:text-purple-700 transition-colors text-sm font-medium">
        Ver todas las categorías
      </a>
    </div>
  </div>
  <a routerLink="/events" (click)="closeMenu()" class="hover:text-slate-900 transition uppercase">
    Eventos
  </a>
  
  <!-- Usuario logueado en móvil -->
  <div *ngIf="isLoggedIn()" class="w-full px-8 space-y-4">
    <div class="flex items-center gap-3 pb-4 border-b border-gray-200">
      <div *ngIf="currentUser?.avatar" class="w-12 h-12 rounded-full overflow-hidden border-2 border-purple-600">
        <img [src]="currentUser!.avatar!" [alt]="currentUser!.name || 'Usuario'" class="w-full h-full object-cover">
      </div>
      <div *ngIf="!currentUser?.avatar" [class]="'w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold ' + getAvatarColor(currentUser?.name || 'Usuario')">
        {{ getInitials(currentUser?.name || 'Usuario') }}
      </div>
      <div>
        <p class="font-semibold text-slate-900">{{ currentUser?.name }}</p>
        <p class="text-sm text-slate-600">{{ currentUser?.email }}</p>
      </div>
    </div>
    <a routerLink="/perfil" (click)="closeMenu()" class="block hover:text-slate-900 transition uppercase">
      Mi Perfil
    </a>
    <a routerLink="/pedidos" (click)="closeMenu()" class="block hover:text-slate-900 transition uppercase">
      Mis Pedidos
    </a>
    <button (click)="logout(); closeMenu()" class="w-full text-left text-red-600 hover:text-red-700 transition uppercase">
      Cerrar sesión
    </button>
  </div>

  <!-- Usuario no logueado en móvil -->
  <a *ngIf="!isLoggedIn() && !isAdmin()" routerLink="/auth" (click)="closeMenu()" class="hover:text-slate-900 transition uppercase">
    Iniciar Sesión
  </a>
  <a *ngIf="!isLoggedIn() && !isAdmin()" routerLink="/auth/register" (click)="closeMenu()" class="flex items-center gap-2 px-5 py-2.5 bg-slate-900 text-white hover:bg-slate-800 active:scale-95 transition-all rounded-full text-sm font-medium mt-4">
    <span>Registrarse</span>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M5 12h14"/>
      <path d="m12 5 7 7-7 7"/>
    </svg>
  </a>
  <!-- Admin en móvil -->
  <a *ngIf="isAdmin()" (click)="goToAdminPanel(); closeMenu()" class="hover:text-slate-900 transition uppercase">
    Panel Administrador
  </a>
  <button type="button" (click)="closeMenu()" class="absolute top-4 right-4 aspect-square size-10 p-1 items-center justify-center bg-slate-100 hover:bg-slate-200 transition text-black rounded-md flex" aria-label="Cerrar menú">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M18 6 6 18"/>
      <path d="m6 6 12 12"/>
    </svg>
  </button>
</div>
