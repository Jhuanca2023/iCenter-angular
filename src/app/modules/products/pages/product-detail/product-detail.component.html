<main class="min-h-screen bg-white py-4 sm:py-8">
  <!-- Loading state -->
  <div *ngIf="isLoading" class="max-w-6xl w-full px-4 sm:px-6 mx-auto">
    <div class="flex items-center justify-center py-20">
      <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mb-4"></div>
        <p class="text-gray-600">Cargando producto...</p>
      </div>
    </div>
  </div>

  <!-- Error state -->
  <div *ngIf="error && !isLoading" class="max-w-6xl w-full px-4 sm:px-6 mx-auto">
    <div class="text-center py-20">
      <p class="text-red-600 mb-4">{{ error }}</p>
      <a routerLink="/productos" class="text-indigo-500 hover:text-indigo-600">Volver a productos</a>
    </div>
  </div>

  <!-- Product content -->
  <div *ngIf="product && !isLoading && !error" class="max-w-6xl w-full px-4 sm:px-6 mx-auto">
    <app-breadcrumbs [items]="breadcrumbs"></app-breadcrumbs>

    <div class="flex flex-col md:flex-row md:items-start gap-6 md:gap-16 mt-4">
      <!-- Galería de imágenes -->
      <div class="flex flex-col sm:flex-row items-start gap-3 w-full md:w-1/2">
        <!-- Thumbnails - ocultos en mobile, visibles en desktop -->
        <div class="hidden sm:flex flex-col gap-3 flex-shrink-0">
          <div 
            *ngFor="let img of images" 
            (click)="selectImage(img)"
            [class.border-indigo-500]="selectedImage === img"
            class="border w-20 h-20 sm:w-24 sm:h-24 border-gray-500/30 rounded overflow-hidden cursor-pointer hover:border-indigo-500 transition">
            <img [src]="img" [alt]="'Thumbnail ' + img" class="w-full h-full object-cover">
          </div>
        </div>

        <!-- Imagen principal -->
        <div 
          class="border border-gray-500/30 w-full sm:w-auto rounded overflow-hidden relative">
          <!-- Badge de descuento -->
          <!-- Discount badge removed from image as per request, now in details -->
          <img 
            [src]="selectedImage || product.image" 
            [alt]="product.name || 'Producto'" 
            class="product-image w-full h-auto max-w-md max-h-[500px] object-contain">
        </div>

        <!-- Thumbnails móvil - debajo de la imagen principal -->
        <div class="flex sm:hidden gap-2 overflow-x-auto pb-2 -mx-4 px-4">
          <div 
            *ngFor="let img of images" 
            (click)="selectImage(img)"
            [class.border-indigo-500]="selectedImage === img"
            class="border w-16 h-16 flex-shrink-0 border-gray-500/30 rounded overflow-hidden cursor-pointer hover:border-indigo-500 transition">
            <img [src]="img" [alt]="'Thumbnail ' + img" class="w-full h-full object-cover">
          </div>
        </div>
      </div>

      <div class="text-sm w-full md:w-1/2" *ngIf="product">
        <h1 class="text-2xl sm:text-3xl font-medium">{{ product.name }}</h1>

        <!-- Rating Summary -->
        <div class="flex items-center gap-2 mt-1">
          <div class="flex items-center gap-0.5">
             <svg *ngFor="let star of getStarsArray(Math.round(ratingAverage))" 
                width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" 
                   [attr.fill]="star ? '#facc15' : '#e5e7eb'" />
             </svg>
          </div>
          <p class="text-sm text-gray-700">
            <span *ngIf="ratingCount > 0">{{ ratingAverage | number:'1.1-1' }} Rating ({{ ratingCount }} reseñas)</span>
            <span *ngIf="ratingCount === 0">Sin reseñas</span>
          </p>
        </div>

        <div class="mt-4 sm:mt-6">
           <div class="flex items-center gap-3">
             <p class="text-3xl font-bold text-indigo-600">${{ finalPrice | number:'1.2-2' }}</p>
             <div *ngIf="hasDiscount" class="flex items-center gap-2">
                <span class="text-gray-400 line-through text-lg">${{ originalPrice | number:'1.2-2' }}</span>
                <span class="bg-orange-100 text-orange-600 px-2 py-1 rounded text-sm font-bold">{{ discountPercentage }}% OFF</span>
             </div>
           </div>
           <span class="text-xs sm:text-sm text-gray-500/70">(incluye todos los impuestos)</span>
        </div>

        <!-- Selector de colores (solo si tiene colores) -->
        <div *ngIf="hasColors" class="mt-6">
          <p class="text-sm font-medium text-gray-900 mb-3">Selecciona el color</p>
          <div class="flex gap-3 flex-wrap">
            <button
              *ngFor="let color of colors"
              type="button"
              (click)="selectColor(color)"
              class="w-6 h-6 rounded-full transition-all hover:scale-110 relative"
              [style.background-color]="color.hex"
              [class.border-2]="selectedColor?.name === color.name"
              [class.border-green-500]="selectedColor?.name === color.name"
              [class.border]="selectedColor?.name !== color.name"
              [class.border-gray-300]="selectedColor?.name !== color.name && color.hex === '#FFFFFF'"
              [class.border-gray-200]="selectedColor?.name !== color.name && color.hex !== '#FFFFFF'"
              [attr.aria-label]="'Color ' + color.name"
              [title]="color.name">
            </button>
          </div>
        </div>

        <!-- Información adicional del producto -->
        <div class="mt-4 space-y-2 text-sm text-gray-600">
          <p *ngIf="productBrand"><strong>Marca:</strong> {{ productBrand }}</p>
          <p *ngIf="product.weight"><strong>Peso:</strong> {{ product.weight }}</p>
          <p *ngIf="product.stock !== undefined"><strong>Stock disponible:</strong> {{ product.stock }} unidades</p>
        </div>

        <!-- Sección de Características -->
        <div class="mt-6 border-t border-gray-200 pt-6">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Características</h3>
          <ul class="space-y-3 text-gray-600">
            <li class="flex items-center">
              <svg class="h-5 w-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              <span>Garantía de 1 año gratis</span>
            </li>
            <li class="flex items-center">
              <svg class="h-5 w-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              <span>Envío gratis</span>
            </li>
            <li class="flex items-center">
              <svg class="h-5 w-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              <span>100% garantía de devolución de dinero</span>
            </li>
            <li class="flex items-center">
              <svg class="h-5 w-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              <span>Soporte al cliente 24/7</span>
            </li>
            <li class="flex items-center">
              <svg class="h-5 w-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
              <span>Método de pago seguro</span>
            </li>
          </ul>
        </div>



        <div class="flex flex-col sm:flex-row items-stretch sm:items-center mt-6 sm:mt-10 gap-3 sm:gap-4 text-sm sm:text-base">
          <app-product-quantity-selector
            [quantity]="quantity"
            [maxQuantity]="product.stock"
            (quantityChange)="onQuantityChange($event)">
          </app-product-quantity-selector>
          <button type="button" (click)="addItemToCart()" class="w-full py-3 sm:py-3.5 font-medium bg-gray-100 text-gray-800/80 hover:bg-gray-200 transition cursor-pointer rounded-lg">
            Agregar al Carrito
          </button>
          <button type="button" (click)="buyNow()" class="w-full py-3 sm:py-3.5 font-medium bg-indigo-500 text-white hover:bg-indigo-600 transition cursor-pointer rounded-lg">
            Comprar Ahora
          </button>
        </div>
      </div>
    </div>

    <!-- Tabs Section -->
    <div class="mt-12">
      <div class="border-b border-gray-200">
        <nav class="-mb-px flex space-x-8 justify-center">
          <button (click)="activeTab = 'description'" 
                  [class.border-indigo-500]="activeTab === 'description'"
                  [class.text-indigo-600]="activeTab === 'description'"
                  class="whitespace-nowrap pb-4 px-1 border-b-2 font-medium text-sm transition-colors uppercase tracking-wider"
                  [class.border-transparent]="activeTab !== 'description'"
                  [class.text-gray-500]="activeTab !== 'description'">
            DESCRIPTION
          </button>
          <button (click)="activeTab = 'reviews'"
                  [class.border-indigo-500]="activeTab === 'reviews'"
                  [class.text-indigo-600]="activeTab === 'reviews'"
                  class="whitespace-nowrap pb-4 px-1 border-b-2 font-medium text-sm transition-colors uppercase tracking-wider"
                  [class.border-transparent]="activeTab !== 'reviews'"
                  [class.text-gray-500]="activeTab !== 'reviews'">
            REVIEW
          </button>
        </nav>
      </div>
      
      <div class="py-8">
         <div *ngIf="activeTab === 'description'">
           <div class="prose max-w-none text-gray-600">
              <h3 class="text-xl font-bold text-gray-900 mb-4">Description</h3>
              <p class="whitespace-pre-line leading-relaxed">{{ product.description }}</p>
           </div>
           
           <!-- Specifications -->
           <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
             <div class="flex border-b border-gray-100 py-2" *ngIf="product.weight">
               <span class="font-medium text-gray-900 w-1/3">Weight</span>
               <span class="text-gray-600">{{ product.weight }}</span>
             </div>
             <div *ngFor="let spec of product.specifications" class="flex border-b border-gray-100 py-2">
               <span class="font-medium text-gray-900 w-1/3">{{ spec.key }}</span>
               <span class="text-gray-600">{{ spec.value }}</span>
             </div>
           </div>
         </div>
         
         <div *ngIf="activeTab === 'reviews'">
           <app-review-list 
              [productId]="product.id!" 
              [ratingSummary]="{ productId: product.id!, average: ratingAverage, count: ratingCount, userRating: userRating }"
              (reviewUpdated)="loadProductRating()">
           </app-review-list>
         </div>
      </div>
    </div>

  </div>
</main>
